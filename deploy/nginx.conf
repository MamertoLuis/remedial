# Example Nginx configuration for Django + Gunicorn + Whitenoise

upstream app_server {
    # fail_timeout=0 means we always retry an upstream even if it failed
    # to return a good HTTP response
    server 127.0.0.1:8000 fail_timeout=0;
}

server {
    listen 80;
    server_name example.com www.example.com;

    # Redirect all HTTP requests to HTTPS
    return 301 https://$host$request_uri;
}

server {
    listen 443 ssl;
    server_name example.com www.example.com;

    # SSL configuration (replace with your actual paths)
    # ssl_certificate /etc/letsencrypt/live/example.com/fullchain.pem;
    # ssl_certificate_key /etc/letsencrypt/live/example.com/privkey.pem;

    client_max_body_size 4G;

    # Path to your project
    root /path/to/your/project/remedial;

    # Static files are handled by Whitenoise in Django, but you can also serve them directly via Nginx
    # location /static/ {
    #     alias /path/to/your/project/remedial/staticfiles/;
    # }

    # Media files (if any)
    # location /media/ {
    #     alias /path/to/your/project/remedial/media/;
    # }

    location / {
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_set_header Host $http_host;
        
        # We don't want nginx trying to do something clever with
        # redirects, we set the Host: header above already.
        proxy_redirect off;
        
        proxy_pass http://app_server;
    }

    # Error pages
    error_page 500 502 503 504 /500.html;
    location = /500.html {
        root /path/to/your/project/remedial/templates;
    }
}
